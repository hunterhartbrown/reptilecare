<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReptileCare</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header id="main-header"></header>

    <section>
        <div class="content-slider">
            <!-- Dynamic content will be loaded here by the script below -->
            <div class="dots-container"></div>
        </div>
    </section>

    <footer style="margin-left: 20px;">
        <p>&copy; 2025 ReptileCare. All rights reserved.</p>
    </footer>    

  <script>
    // loadJson stays the same…
    function loadJson(fileName, callback) {
      var xobj = new XMLHttpRequest();
      xobj.overrideMimeType("application/json");
      xobj.open('GET', fileName, true);
      xobj.onreadystatechange = function () {
        if (xobj.readyState === 4 && xobj.status === 200) {
          callback(JSON.parse(xobj.responseText));
        }
      };
      xobj.send(null);
    }

    var slideIndex = 0,
        autoTimer;

    function init() {
      loadJson('/data/reptile_care_data.json', function(data) {
        var container   = document.querySelector('.content-slider'),
            dotsWrapper = container.querySelector('.dots-container');

        // 1) Build slides & dots
        data.forEach(function(item, idx) {
          // — build slide —
          var slide = document.createElement('div');
          slide.className = 'slide';
          slide.style.display = idx === 0 ? 'flex' : 'none';

          var imgDiv = document.createElement('div');
          imgDiv.className = 'slide-image';
          var img = document.createElement('img');
          img.src = item['Picture Link'];
          img.alt = item['Common Name'];
          if (img.src.includes("Leopard-Gecko-Climbing.jpg")) {
            img.classList.add('problematic-image');
          }
          imgDiv.appendChild(img);

          var textDiv = document.createElement('div');
          textDiv.className = 'overlay-text';
          textDiv.innerHTML = 
            `<h3 class="common-name">${item['Common Name']}</h3>` +
            `<h4 class="species-name">${item['Species']}</h4>`;

          slide.appendChild(imgDiv);
          slide.appendChild(textDiv);
          // insert slide before dotsContainer so dots stay at bottom
          container.insertBefore(slide, dotsWrapper);

          // — build dot —
          var dot = document.createElement('span');
          dot.className = 'dot' + (idx === 0 ? ' active' : '');
          dot.dataset.slide = idx;
          dot.addEventListener('click', function() {
            showSlide(parseInt(this.dataset.slide, 10));
          });
          dotsWrapper.appendChild(dot);
        });

        // 2) start auto-rotation
        rotateSlides();
      });
    }

    function showSlide(n) {
      var slides = document.getElementsByClassName('slide'),
          dots   = document.getElementsByClassName('dot');

      // hide all slides & clear active from all dots
      for (var i = 0; i < slides.length; i++) {
        slides[i].style.display = 'none';
        dots[i].classList.remove('active');
      }

      // show the selected one
      slides[n].style.display = 'flex';
      dots[n].classList.add('active');

      // reset slideIndex so auto continues from here
      slideIndex = n;
    }

    function rotateSlides() {
      var slides = document.getElementsByClassName('slide'),
          total  = slides.length;

      clearTimeout(autoTimer);
      slideIndex = (slideIndex + 1) % total;
      showSlide(slideIndex);

      // queue next
      autoTimer = setTimeout(rotateSlides, 6000);
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>

  <!-- Header Loader Script -->
  <script>
    fetch('header.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('main-header').innerHTML = data;
        
        // Initialize mobile menu after header is loaded
        initMobileMenu();
      })
      .catch(error => {
        console.error('Error loading header:', error);
      });

    // Mobile Menu Functionality
    function initMobileMenu() {
      // Small delay to ensure DOM is fully rendered
      setTimeout(function() {
        const mobileToggle = document.getElementById('mobile-toggle');
        const mobileMenu = document.getElementById('mobile-menu');
        
        if (!mobileToggle || !mobileMenu) {
          console.warn('Mobile menu elements not found - retrying...');
          // Retry after a short delay if elements aren't found
          setTimeout(initMobileMenu, 100);
          return;
        }

        console.log('Mobile menu initialized successfully');

        // Remove any existing event listeners to prevent duplicates
        mobileToggle.replaceWith(mobileToggle.cloneNode(true));
        const newMobileToggle = document.getElementById('mobile-toggle');

        // Toggle mobile menu
        newMobileToggle.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          
          console.log('Mobile menu toggle clicked');
          
          const isActive = this.classList.contains('active');
          
          if (isActive) {
            // Close menu
            this.classList.remove('active');
            mobileMenu.classList.remove('show');
            console.log('Menu closed');
          } else {
            // Open menu
            this.classList.add('active');
            mobileMenu.classList.add('show');
            console.log('Menu opened');
          }
        });

        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
          const isClickInsideHeader = event.target.closest('header');
          
          if (!isClickInsideHeader && mobileMenu.classList.contains('show')) {
            newMobileToggle.classList.remove('active');
            mobileMenu.classList.remove('show');
            console.log('Menu closed by outside click');
          }
        });

        // Close mobile menu when clicking on a nav link
        const mobileNavLinks = mobileMenu.querySelectorAll('.mobile-nav-links a');
        mobileNavLinks.forEach(function(link) {
          link.addEventListener('click', function() {
            newMobileToggle.classList.remove('active');
            mobileMenu.classList.remove('show');
            console.log('Menu closed by nav link click');
          });
        });

        // Close mobile menu when window is resized to desktop
        window.addEventListener('resize', function() {
          if (window.innerWidth > 1024) {
            newMobileToggle.classList.remove('active');
            mobileMenu.classList.remove('show');
            console.log('Menu closed due to window resize');
          }
        });

        // Test the mobile menu functionality
        console.log('Mobile toggle element:', newMobileToggle);
        console.log('Mobile menu element:', mobileMenu);
        
      }, 50);
    }
  </script>
</body>
</html>
